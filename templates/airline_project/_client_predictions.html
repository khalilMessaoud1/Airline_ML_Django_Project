{# templates/airline_project/_client_predictions.html #}

{% if predictions and predictions.predictions_completed %}


  <!-- Detailed Predictions Cards -->
  <div class="row">

    {% if show_habiba %}
    <!-- HABIBA -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h4 class="card-title">Customer Segmentation &amp; CLV</h4>
          <p class="card-category">By HABIBA</p>
        </div>
        <div class="card-body">
          <table class="table">
            <tr>
              <td><strong>Segmentation Cluster:</strong></td>
              <td>{{ predictions.segmentation_label }}</td>
            </tr>
            <tr>
              <td><strong>CLV Prediction:</strong></td>
              <td>${{ predictions.clv_prediction|floatformat:2 }}</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
    {% endif %}

    {% if show_adhem %}
    <!-- ADHEM -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h4 class="card-title">Churn Risk Analysis</h4>
          <p class="card-category">By ADHEM</p>
        </div>
        <div class="card-body">
          <table class="table">
            <tr>
              <td><strong>Churn Risk:</strong></td>
              <td>
                <span class="badge badge-{{ predictions.churn_risk_label|lower }}">
                  {{ predictions.churn_risk_label }}
                </span>
              </td>
            </tr>
            <tr>
              <td><strong>Months Until Churn:</strong></td>
              <td>{{ predictions.churn_months|floatformat:1 }} months</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
    {% endif %}

    {% if show_asma %}
    <!-- ASMA (admin only) -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h4 class="card-title">Enrollment Insights</h4>
          <p class="card-category">By ASMA</p>
        </div>
        <div class="card-body">
          <table class="table">
            <tr>
              <td><strong>Engagement Level:</strong></td>
              <td>{{ predictions.engagement_label }}</td>
            </tr>
            <tr>
              <td><strong>Equity Segment:</strong></td>
              <td>{{ predictions.equity_segment_label }}</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
    {% endif %}

    {% if show_wajd %}
    <!-- WAJD -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h4 class="card-title">Loyalty Points Analysis</h4>
          <p class="card-category">By WAJD</p>
        </div>
        <div class="card-body">
          <table class="table">
            <tr>
              <td><strong>Loyalty Classification:</strong></td>
              <td>
                {% if predictions.loyalty_points_classification_label == 0 %}
                  Non redeemers
                {% else %}
                  Redeemer
                {% endif %}
              </td>
            </tr>
            <tr>
              <td><strong>Loyalty Cluster:</strong></td>
              <td>{{ predictions.loyalty_cluster_label }}</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
    {% endif %}

    {% if show_khalil %}
    <!-- KHALIL -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h4 class="card-title">Travel Behavior Analysis</h4>
          <p class="card-category">By KHALIL</p>
        </div>
        <div class="card-body">
          <table class="table">
            <tr>
              <td><strong>Preferred Season:</strong></td>
              <td>{{ predictions.khalil_preferred_season }}</td>
            </tr>
            <tr>
              <td><strong>Travel Behavior Cluster:</strong></td>
              <td>{{ predictions.khalil_cluster_name }}</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
    {% endif %}

    {% if show_molka %}
    <!-- MOLKA -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h4 class="card-title">Loyalty Program</h4>
          <p class="card-category">By MOLKA</p>
        </div>
        <div class="card-body">
          <table class="table">
            <tr>
              <td><strong>Current Tier:</strong></td>
              <td>{{ client.tier }}</td>
            </tr>
            <tr>
              <td><strong>Tier Progression:</strong></td>
              <td>{{ predictions.tier_progression_label }}</td>
            </tr>
            <tr>
              <td><strong>Top Accelerators:</strong></td>
              <td>{{ predictions.tier_upgrade_prediction|default:"N/A" }}</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
    {% endif %}

  </div>

{% else %}
  <!-- Predictions not ready -->
  <div class="row">
    <div class="col-md-12">
      <div class="card">
        <div class="card-body">
          <div class="alert alert-warning">
            <h4><i class="tim-icons icon-time-alarm"></i> ML Predictions in Progress...</h4>
            <p>The ML models are currently running predictions for this client. This may take a few moments. Please refresh the page.</p>
            <button class="btn btn-warning" onclick="location.reload()">
              <i class="tim-icons icon-refresh-02"></i> Refresh Page
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endif %}
